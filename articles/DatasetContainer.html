<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>DatasetContainer • saildb</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="DatasetContainer">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">saildb</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Connection.html">Connection</a></li>
    <li><a class="dropdown-item" href="../articles/DatasetContainer.html">DatasetContainer</a></li>
    <li><a class="dropdown-item" href="../articles/Profile.html">Profile</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>DatasetContainer</h1>
                        <h4 data-toc-skip class="author">Jack
Scanlon</h4>
            
            <h4 data-toc-skip class="date">2024-09-09</h4>
      

      <div class="d-none name"><code>DatasetContainer.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="the-saildbdatasetcontainer-class">The <code>saildb::DatasetContainer</code> class<a class="anchor" aria-label="anchor" href="#the-saildbdatasetcontainer-class"></a>
</h2>
<p>This <code>R6</code> class may feel reminiscent of the
<code>ProjectDatasets</code> class, it is intended to serve a similar if
not the same purpose, but has expanded upon its somewhat limited
functionality.</p>
<p>The <code><a href="../reference/SAIL-DatasetContainer.html">saildb::DatasetContainer</a></code> provides a method of
defining a set of datasets to be used in a project to improve inline
documentation, reduce issues with undocumented use of datasets and to
promote hermiticity to ensure that the same input datsets and
configuration produce the same output. The most obvious benefit of this
when initially using it will be the ease of updating datasets with their
new refreshes.</p>
<div class="section level3">
<h3 id="getting-started">Getting Started<a class="anchor" aria-label="anchor" href="#getting-started"></a>
</h3>
<div class="section level4">
<h4 id="defining-a-saildbdatasetcontainer">Defining a <code>saildb::DatasetContainer</code><a class="anchor" aria-label="anchor" href="#defining-a-saildbdatasetcontainer"></a>
</h4>
<blockquote>
<p><em><strong>Note:</strong> Don’t forget to load the package into your
enviroment by entering the following:
<code><a href="https://rdrr.io/r/base/library.html" class="external-link">library(saildb)</a></code></em></p>
</blockquote>
<p>You can define a <code><a href="../reference/SAIL-DatasetContainer.html">saildb::DatasetContainer</a></code> by entering
the following:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">container</span> <span class="op">=</span> <span class="va"><a href="../reference/SAIL-DatasetContainer.html">DatasetContainer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="co"># Define a reference to a table found within our project</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#  NOTE:</span></span>
<span>  <span class="co">#   - This produces a `DatasetRef` object - this is discussed below, and all</span></span>
<span>  <span class="co">#     available datasets can be found within `SAILDB.METADATA`</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#   - Note that unlike unknown tables, you can pass `DatasetRef` items with</span></span>
<span>  <span class="co">#     _OR_ without naming them</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'pedw.spell'</span>, <span class="st">'SAIL999V'</span>, <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="st">'2024-07-29'</span><span class="op">)</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># Define another reference to a dataset but provide the name instead:</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#  NOTE:</span></span>
<span>  <span class="co">#    - If you do choose to name the `DatasetRef` items, they MUST match</span></span>
<span>  <span class="co">#      the name defined by `SAILDB.METADATA` _i.e._ the name of the dataset</span></span>
<span>  <span class="co">#      you've included in the first argument below</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#    - You may also note that we are passing the `date` argument as a</span></span>
<span>  <span class="co">#      character string now instead of an `as.Date()` object; either are</span></span>
<span>  <span class="co">#      completely acceptable!</span></span>
<span>  <span class="co">#</span></span>
<span>  pedw.episode <span class="op">=</span> <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'pedw.episode'</span>, <span class="st">'SAIL999V'</span>, <span class="st">'2024-07-29'</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># You can also define references to datasets that don't have refreshes</span></span>
<span>  <span class="co"># such as in the case of `SAILREFRV` tables, _e.g._ ...</span></span>
<span>  <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'sailref.wimd2019.sm.area'</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="co"># Define some workspace / project table that's required for the script and/or</span></span>
<span>  <span class="co"># package that you're working on</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#  NOTE:</span></span>
<span>  <span class="co">#   - Unlike `DatasetRef` items, you _must_ provide any unknown tables</span></span>
<span>  <span class="co">#     by name - i.e. they cannot be passed in a manner such as:</span></span>
<span>  <span class="co">#     `DatasetContainer$new('SAILW999V.SOME_COHORT_TABLE')</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#   - See below for correct usage of unknown tables:</span></span>
<span>  <span class="co">#</span></span>
<span>  some.table <span class="op">=</span> <span class="st">'SAILW999V.SOME_COHORT_TABLE'</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="where-are-the-datasetref-tables-coming-from">Where are the <code>DatasetRef</code> tables coming from?<a class="anchor" aria-label="anchor" href="#where-are-the-datasetref-tables-coming-from"></a>
</h4>
<p>The <code>DatasetRef</code> items referenced above are recorded
within the <code>SAILDB.METADATA</code> constant exported in this
package. It contains a list of commonly used datasets with reference to
their origin and how their refreshes are constructed; this allows easy,
reproducible use.</p>
<p>Please see <code><a href="../reference/SAIL-Metadata.html">saildb::SAILDB.METADATA</a></code>, you can print this
in your console if you’d prefer to access it via code, or view it
through the interface using the <code>View</code> function,
<em>e.g.</em> …</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="fu">saildb</span><span class="fu">::</span><span class="va"><a href="../reference/SAIL-Metadata.html">SAILDB.METADATA</a></span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="interacting-with-the-datasetcontainer">Interacting with the <code>DatasetContainer</code><a class="anchor" aria-label="anchor" href="#interacting-with-the-datasetcontainer"></a>
</h3>
<div class="section level4">
<h4 id="get-all-datasets-from-the-container">Get all datasets from the container<a class="anchor" aria-label="anchor" href="#get-all-datasets-from-the-container"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># List of all dataset references</span></span>
<span><span class="va">container</span><span class="op">$</span><span class="va">datasets</span></span>
<span></span>
<span><span class="co"># Loop through all datasets</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">dataset</span> <span class="kw">in</span> <span class="va">container</span><span class="op">$</span><span class="va">datasets</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># do something...</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="get-the-dataset-reference-object-from-the-container">Get the dataset reference object from the container<a class="anchor" aria-label="anchor" href="#get-the-dataset-reference-object-from-the-container"></a>
</h4>
<p>The subscript/index operator has been overloaded for the
<code>DatasetContainer</code> instance so that it can act as both an R6
class and list simultaneously.</p>
<p>To retrieve specific datasets from the container you can enter the
following:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get a single dataset from the container</span></span>
<span><span class="va">container</span><span class="op">[[</span><span class="st">'pedw.spell'</span><span class="op">]</span><span class="op">]</span> <span class="co"># -&gt; DatasetRef('pedw.spell')</span></span>
<span></span>
<span><span class="co"># Get one or more datasets from the container</span></span>
<span><span class="va">container</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pedw.spell'</span>, <span class="st">'pedw.episode'</span><span class="op">)</span><span class="op">]</span> <span class="co"># -&gt; c(DatasetRef('pedw.spell', ...))</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="get-the-full-dataset-schema-table-name-from-the-container">Get the full dataset schema &amp; table name from the container<a class="anchor" aria-label="anchor" href="#get-the-full-dataset-schema-table-name-from-the-container"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Get the dataset name out of the container</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  Note:</span></span>
<span><span class="co">#   - The dataset name will have any required prefixes and suffixes</span></span>
<span><span class="co">#     prepended/appended, such that 'pedw.episode' will expand into</span></span>
<span><span class="co">#     'SAILXXXV.PEDW_EPISODE_20240709' etc</span></span>
<span><span class="co">#</span></span>
<span><span class="va">pedw.table.name</span> <span class="op">=</span> <span class="va">container</span><span class="op">$</span><span class="fu">get</span><span class="op">(</span><span class="st">'pedw.episode'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Let's assume we want to use it in a query...</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  Note:</span></span>
<span><span class="co">#   - We're using the `stringr` package to perform string interpolation here</span></span>
<span><span class="co">#</span></span>
<span><span class="va">db</span><span class="op">$</span><span class="fu">run</span><span class="op">(</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_interp.html" class="external-link">str_interp</a></span><span class="op">(</span><span class="st">"</span></span>
<span><span class="st">  SELECT *</span></span>
<span><span class="st">    FROM ${pedw.table.name};</span></span>
<span><span class="st">"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># i.e. the above interpolated string has become:</span></span>
<span><span class="co">#</span></span>
<span><span class="st">"</span></span>
<span><span class="st">  SELECT *</span></span>
<span><span class="st">    FROM SAIL999V.PEDW_SPELL_20240709;</span></span>
<span><span class="st">"</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="retrieve-specific-parts-from-a-dataset-reference-from-the-container">Retrieve specific parts from a dataset reference from the
container<a class="anchor" aria-label="anchor" href="#retrieve-specific-parts-from-a-dataset-reference-from-the-container"></a>
</h4>
<p>You may retrieve specific components of a dataset reference through
the <code>$retrieve</code> method. Please see the
<code>DatasetContainer$retrieve</code> method documentation for more
details on the different components that can be retrieved from a
<code>DatasetRef</code> / <code>DatasetItem</code> object.</p>
<p>Example usage might be:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Retrieve components for a single dataset</span></span>
<span><span class="va">container</span><span class="op">$</span><span class="fu">retrieve</span><span class="op">(</span><span class="st">'pedw.episode'</span>, <span class="st">'schema'</span><span class="op">)</span> <span class="co"># -&gt; the schema provided by the container</span></span>
<span></span>
<span><span class="co"># Retrieve one or more components from one or more datasets</span></span>
<span><span class="va">container</span><span class="op">$</span><span class="fu">retrieve</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pedw.spell'</span>, <span class="st">'pedw.episode'</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'date'</span>, <span class="st">'name'</span>, <span class="st">'schema'</span>, <span class="st">'origin'</span>, <span class="st">'relation'</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="get-the-length-of-datasets-contained-by-the-container">Get the length of datasets contained by the container<a class="anchor" aria-label="anchor" href="#get-the-length-of-datasets-contained-by-the-container"></a>
</h4>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Using the length built-in function</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">container</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Using the class method</span></span>
<span><span class="va">container</span><span class="op">$</span><span class="fu">length</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="set-a-specific-dataset-reference-to-another-reference">Set a specific dataset reference to another reference<a class="anchor" aria-label="anchor" href="#set-a-specific-dataset-reference-to-another-reference"></a>
</h4>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Update pedw.spell to another refresh date</span></span>
<span><span class="va">older.pedw</span> <span class="op">=</span> <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'pedw.spell'</span>, <span class="st">'SAILXXXV'</span>, <span class="st">'2023-07-29'</span><span class="op">)</span></span>
<span><span class="va">container</span><span class="op">$</span><span class="fu">set</span><span class="op">(</span><span class="st">'pedw.spell'</span>, <span class="va">older.pedw</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="validation">Validation<a class="anchor" aria-label="anchor" href="#validation"></a>
</h3>
<div class="section level4">
<h4 id="validating-whether-datasets-are-contained-by-the-datasetcontainer">Validating whether datasets are contained by the
<code>DatasetContainer</code><a class="anchor" aria-label="anchor" href="#validating-whether-datasets-are-contained-by-the-datasetcontainer"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define your container</span></span>
<span><span class="va">container</span> <span class="op">=</span> <span class="va"><a href="../reference/SAIL-DatasetContainer.html">DatasetContainer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'pedw.spell'</span>, schema<span class="op">=</span><span class="st">'SAIL999V'</span>, <span class="st">'2024-07-29'</span><span class="op">)</span>,</span>
<span>  <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'sailref.wimd2019.sm.area'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Later... ensure the correct datasets have been added</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  NOTE:</span></span>
<span><span class="co">#   - This will throw an error if the datasets aren't present; if that's not</span></span>
<span><span class="co">#     what you want to happen and would prefer a logical value then please</span></span>
<span><span class="co">#     add a `assert=FALSE` argument to the call below</span></span>
<span><span class="co">#</span></span>
<span><span class="va">container</span><span class="op">$</span><span class="fu">require.datasets</span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pedw.spell'</span>, <span class="st">'sailref.wimd2019.sm.area'</span><span class="op">)</span>,</span>
<span>  assert<span class="op">=</span><span class="cn">TRUE</span> <span class="co"># defaults to TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="validating-whether-datasets-are-accessible-to-the-client">Validating whether datasets are accessible to the client<a class="anchor" aria-label="anchor" href="#validating-whether-datasets-are-accessible-to-the-client"></a>
</h4>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define your container</span></span>
<span><span class="va">container</span> <span class="op">=</span> <span class="va"><a href="../reference/SAIL-DatasetContainer.html">DatasetContainer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'wlgp.event'</span>, schema<span class="op">=</span><span class="st">'SAIL999V'</span>, <span class="st">'2024-04-01'</span><span class="op">)</span>,</span>
<span>  <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'sailref.wimd2019.sm.area'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Define the db connection</span></span>
<span><span class="va">db</span> <span class="op">=</span> <span class="va"><a href="../reference/SAIL-Connection.html">Connection</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Ensure that the connect user can access the tables</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  NOTE:</span></span>
<span><span class="co">#   - This will throw an error if the datasets aren't accessible; if that's not</span></span>
<span><span class="co">#     what you want to happen and would prefer a logical value then please</span></span>
<span><span class="co">#     add a `assert=FALSE` argument to the call below</span></span>
<span><span class="co">#</span></span>
<span><span class="va">container</span><span class="op">$</span><span class="fu">require.access</span><span class="op">(</span></span>
<span>  <span class="co"># An active, valid db connection to test if the SAIL DB account</span></span>
<span>  <span class="co"># can access the datasets</span></span>
<span>  db         <span class="op">=</span> <span class="va">db</span>,</span>
<span>  <span class="co"># A named list in which the keys (left-hand side) describe the dataset(s) and</span></span>
<span>  <span class="co"># the values (right-hand side) describe the privileges required by the client</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co"># NOTE:</span></span>
<span>  <span class="co">#   - 'ALL' expands to all privileges if used; please find the privileges</span></span>
<span>  <span class="co">#     allowed in the `DatasetContainer$require.access` documentation</span></span>
<span>  <span class="co">#</span></span>
<span>  privileges <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Only select is granted on SAIL reference tables but you could use</span></span>
<span>    <span class="co"># one of the following: ALL, INSERT, UPDATE, ALTER, DELETE etc</span></span>
<span>    <span class="co">#</span></span>
<span>    wlgp.event               <span class="op">=</span> <span class="st">'SELECT'</span>,</span>
<span>    <span class="co"># The required privileges can be a vector or a list, e.g. ...</span></span>
<span>    <span class="co">#</span></span>
<span>    <span class="co">#    - sailref.wimd2019.sm.area = c('SELECT', 'INSERT', 'DELETE')</span></span>
<span>    <span class="co">#  OR;</span></span>
<span>    <span class="co">#    - sailref.wimd2019.sm.area = list('SELECT', 'ALTER')</span></span>
<span>    <span class="co">#</span></span>
<span>    sailref.wimd2019.sm.area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'SELECT'</span><span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># Throw an error if they aren't accessible (defaults to `TRUE`)</span></span>
<span>  assert     <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="validating-whether-datasets-contain-the-columns-required-by-your-code">Validating whether datasets contain the columns required by your
code<a class="anchor" aria-label="anchor" href="#validating-whether-datasets-contain-the-columns-required-by-your-code"></a>
</h4>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define your container</span></span>
<span><span class="va">container</span> <span class="op">=</span> <span class="va"><a href="../reference/SAIL-DatasetContainer.html">DatasetContainer</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'pedw.spell'</span>, schema<span class="op">=</span><span class="st">'SAIL999V'</span>, <span class="st">'2024-07-29'</span><span class="op">)</span>,</span>
<span>  <span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'sailref.wimd2019.sm.area'</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check whether the dataset(s) columns are as expected</span></span>
<span><span class="va">container</span><span class="op">$</span><span class="fu">require.shape</span><span class="op">(</span></span>
<span>  <span class="co"># An active, valid db connection to test if the SAIL DB account</span></span>
<span>  <span class="co"># can access the datasets</span></span>
<span>  db       <span class="op">=</span> <span class="va">db</span>,</span>
<span>  <span class="co"># A list of lists in which the keys (left-hand side) describe the table names</span></span>
<span>  <span class="co"># and the values (right-hand side) describe a list of columns and their expected</span></span>
<span>  <span class="co"># types</span></span>
<span>  criteria <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="co"># Define one or more datasets to test</span></span>
<span>    <span class="co">#</span></span>
<span>    <span class="co">#  NOTE:</span></span>
<span>    <span class="co">#   - You can test as many columns or as little columns as you want;</span></span>
<span>    <span class="co">#     you can just test a subset if you'd prefer and do not have to </span></span>
<span>    <span class="co">#     define every column name/type</span></span>
<span>    <span class="co">#</span></span>
<span>    <span class="co">#   - All SQL types are supported as described by either the SYSIBMADM and/or</span></span>
<span>    <span class="co">#     SYSCAT schemas whom describe the table shape(s)</span></span>
<span>    <span class="co">#</span></span>
<span>    sailref.wimd2019.sm.area <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="co"># LSOA column should be a CHARACTER</span></span>
<span>      <span class="co">#</span></span>
<span>      <span class="co">#  NOTE:</span></span>
<span>      <span class="co">#   - You do not have to supply the size, i.e. `CHARACTER(9)`, you can</span></span>
<span>      <span class="co">#     just define the type instead (`CHARACTER`)</span></span>
<span>      <span class="co">#</span></span>
<span>      <span class="co">#   - Note that this holds true for other types with a size too, incl.</span></span>
<span>      <span class="co">#     but not limited to `DECIMAL(31,8)` where 31 = the size and</span></span>
<span>      <span class="co">#     8 = the scale</span></span>
<span>      <span class="co">#</span></span>
<span>      LSOA2011_CD   <span class="op">=</span> <span class="st">'CHARACTER(9)'</span>,</span>
<span></span>
<span>      <span class="co"># LSOA name column should be a VARCHAR</span></span>
<span>      <span class="co">#</span></span>
<span>      <span class="co">#  NOTE:</span></span>
<span>      <span class="co">#   - As described above, we're not validating the size here; we're just</span></span>
<span>      <span class="co">#     validating that the column exists and that it's of type 'VARCHAR'</span></span>
<span>      <span class="co">#   - However, we could validate the size if we wanted to by amending</span></span>
<span>      <span class="co">#     the following to `VARCHAR(45)` or some other size</span></span>
<span>      <span class="co">#</span></span>
<span>      LSOA2011_DESC <span class="op">=</span> <span class="st">'VARCHAR'</span>,</span>
<span></span>
<span>      <span class="co"># Income rank column should be a INTEGER</span></span>
<span>      <span class="co">#</span></span>
<span>      INCOME_RANK   <span class="op">=</span> <span class="st">'INTEGER'</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="co"># Throw an error if the datasets aren't in the shape expected; defaults to</span></span>
<span>  <span class="co"># `TRUE`</span></span>
<span>  assert <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="misc--methods">Misc. methods<a class="anchor" aria-label="anchor" href="#misc--methods"></a>
</h3>
<div class="section level4">
<h4 id="static-methods-to-generate-datasetref-objects">Static methods to generate <code>DatasetRef</code> objects<a class="anchor" aria-label="anchor" href="#static-methods-to-generate-datasetref-objects"></a>
</h4>
<p>Please see the method documentation for a detailed explanation on how
to use this method, but as an example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Define some dataset reference with a refresh date</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># NOTE:</span></span>
<span><span class="co">#  - The `wlgp.event` table is described by the `SAILDB.METADATA`</span></span>
<span><span class="co">#    list - see documentation and/or call `View(SAILDB.METADATA)`</span></span>
<span><span class="co">#</span></span>
<span><span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span><span class="st">'wlgp.event'</span>, <span class="st">'SAILXXXV'</span>, <span class="st">'2024-04-01'</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The date field can accept either (a) a character string</span></span>
<span><span class="co"># or (b) an as.Date() / as.POSIXct() object</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># NOTE:</span></span>
<span><span class="co">#  - Multiple different datetime format(s) are used in an attempt to parse the</span></span>
<span><span class="co">#    date if a character string is specified, but you can provide your own date</span></span>
<span><span class="co">#    format and time zone if prefered</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  - The timezone defaults to `UTC` if not set</span></span>
<span><span class="co">#</span></span>
<span><span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span></span>
<span>  <span class="co"># Select the `wlgp.event` dataset</span></span>
<span>  dataset  <span class="op">=</span> <span class="st">'wlgp.event'</span>,</span>
<span></span>
<span>  <span class="co"># Define where this table is located; in this case we'll use some project</span></span>
<span>  <span class="co"># schema</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#  NOTE:</span></span>
<span>  <span class="co">#   - Only project, workspace and encryption tables require a schema;</span></span>
<span>  <span class="co">#     these are usually tables that require a refresh suffix e.g.</span></span>
<span>  <span class="co">#     some `SAILXXXV.WLGP_GP_EVENT_20240401` table</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#   - Reference tables, such as in the case of the the WIMD SAILREFRV table</span></span>
<span>  <span class="co">#     (available: `SAILREFRV.WIMD_2019_INDEX_AND_DOMAIN_RANKS_BY_SMALL_AREA`)</span></span>
<span>  <span class="co">#     do not require a date nor a schema</span></span>
<span>  <span class="co">#</span></span>
<span>  schema   <span class="op">=</span> <span class="st">'SAILXXXV'</span>,</span>
<span></span>
<span>  <span class="co"># The refresh date of the dataset</span></span>
<span>  <span class="co">#</span></span>
<span>  <span class="co">#  NOTE:</span></span>
<span>  <span class="co">#   - As above, this is NOT always necessary!</span></span>
<span>  <span class="co">#</span></span>
<span>  date     <span class="op">=</span> <span class="st">'01-04-2024'</span>,</span>
<span></span>
<span>  <span class="co"># How the date is formatted, see as.Date() or as.POSIXct() on CRAN</span></span>
<span>  <span class="co"># for more information on how date formatting works</span></span>
<span>  <span class="co">#</span></span>
<span>  date.fmt <span class="op">=</span> <span class="st">'%d-%m-%Y'</span>,</span>
<span></span>
<span>  <span class="co"># The datetime timezone, see as.Date() or as.POSIXCt() on CRAN for more</span></span>
<span>  <span class="co"># information</span></span>
<span>  <span class="co">#</span></span>
<span>  date.tz  <span class="op">=</span> <span class="st">'UTC'</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create a reference to some reference dataset, e.g. WIMD2019...</span></span>
<span><span class="co">#</span></span>
<span><span class="co"># NOTE:</span></span>
<span><span class="co">#  - Please take note of the fact that we are only supplying the dataset</span></span>
<span><span class="co">#    name</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  - The reason for this is that the SAILREFRV.WIMD2019 is a static reference</span></span>
<span><span class="co">#    table that doesn't include refreshes; the next version of the WIMD</span></span>
<span><span class="co">#    dataset will likely be created as a new, distinct table</span></span>
<span><span class="co">#</span></span>
<span><span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">ref</span><span class="op">(</span></span>
<span>  dataset <span class="op">=</span> <span class="st">'sailref.wimd2019.sm.area'</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="static-methods-validation">Static methods &amp; validation<a class="anchor" aria-label="anchor" href="#static-methods-validation"></a>
</h4>
<p>The following static methods may be used for type validation of
<code><a href="../reference/SAIL-DatasetContainer.html">saildb::DatasetContainer</a></code> instances, and can be used to test
the names of datasets:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Check if some object is a `saildb::DatasetContainer`</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  NOTE:</span></span>
<span><span class="co">#   - Static methods CANNOT be accessed via the `container` instance;</span></span>
<span><span class="co">#     they can only be accessed via the top-level class like below:</span></span>
<span><span class="co">#</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">is</span><span class="op">(</span><span class="va">container</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="st">'It is a DatasetContainer!'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/try.html" class="external-link">try</a></span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="va">container</span><span class="op">$</span><span class="fu">is</span><span class="op">(</span><span class="va">container</span><span class="op">)</span> <span class="co"># this will fail!</span></span>
<span><span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Check if a name is reserved by `SAILDB.METADATA`</span></span>
<span><span class="co">#</span></span>
<span><span class="co">#  Note:</span></span>
<span><span class="co">#   - As above, this CANNOT be accessed via the `container` instance; you must</span></span>
<span><span class="co">#     access it at the top-level `DatasetContainer`</span></span>
<span><span class="co">#</span></span>
<span><span class="va">DatasetContainer</span><span class="op">$</span><span class="fu">is.reserved</span><span class="op">(</span><span class="st">'wlgp.event'</span><span class="op">)</span> <span class="co"># -&gt; TRUE</span></span></code></pre></div>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jack Scanlon.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
